[
    {cds, [
        {ip, "::"},
        {port, 8022},
        {net_opts, [
            % Bump keepalive timeout up to a minute
            {timeout, 60000}
        ]},
        {scrypt_opts, {16384, 8, 1}},
        {keyring_storage, cds_keyring_storage_env},
        {storage, cds_storage_ets},
        % {storage, cds_storage_riak},
        % {cds_storage_riak, #{
        %     conn_params => #{
        %         host => "riakdb",
        %         port => 8087
        %     },
        %     timeout => 5000 % milliseconds
        % }},
        {session_cleaning, #{
            interval => 3000,
            batch_size => 5000,
            session_lifetime => 3600
        }},
        {recrypting, #{
            interval => 3000,
            batch_size => 5000
        }},
        {health_checkers, [
            {erl_health, disk     , ["/", 99]  },
            {erl_health, cg_memory, [99]       },
            {erl_health, service  , [<<"cds">>]}
        ]},
        {keyring_rotation_lifetime, 60000},
        {keyring_initialize_lifetime, 180000},
        {shareholders, #{
            <<"1">> => #{
                owner => <<"ndiezel">>,
                public_keys => #{
                    enc => <<"{
  \"use\": \"enc\",
  \"kty\": \"RSA\",
  \"kid\": \"KUb1fNMc5j9Ei_IV3DguhJh5UOH30uvO7qXq13uevnk\",
  \"alg\": \"RSA-OAEP-256\",
  \"n\": \"2bxkamUQjD4CN8rcq5BfNLJmRmosb-zY7ajPBJqtiLUTcqym23OkUIA1brBg34clmU2ZQmtd3LWi5kVJk_wr4WsMG_78jHK3wQA-HRhY4WZDZrULTsi4XWpNSwL4dCml4fs536RKy_TyrnpiXg0ug4JVVaEeo7VIZ593mVhCxC8Ev6FK8tZ2HGGOerUXLpgQdhcp9UwaI_l7jgoWNp1f7SuBqv1mfiw4ziC1yvwyXHTKy-37LjLmVB9EVyjqpkwZgzapaOvHc1ABqJpdOrUh-PyOgq-SduqSkMrvqZEdUeR_KbFVxqbxqWJMrqkl2HOJxOla9cHRowg5ObUBjeMoaTJfqie3t6uRUsFEFMzhIyvo6QMYHooxIdOdwpZ4tpzML6jv9o5DPtN375bKzy-UsjeshYbvad1mbrcxc8tYeiQkDZEIM0KeOdHm5C6neEyY6oF4s1vSYBNCnhE5O-R9dmp8Sk5KEseEkOH5u4G2RsIXBA9z1OTDoy6qF21EvRCGzsGfExfkmPAtzbnS-EHHxbMUiio0ZJoZshYo8dwJY6vSN7UsXBgW1v7GvIF9VsfzRmgkl_3rdemYy28DJKC0U2yufePcA3nUJEhtR3UO_tIlHxZvlDSX5eTx4vs5VkFfujNSiPsgH0PEeXABGBFbal7QxU1u0XHXIFwhW5cM8Fs\",
  \"e\": \"AQAB\"
}">>,
                    sig => <<"{
    \"crv\":\"Ed25519\",
    \"kid\":\"0S3dDL16upIQpkt5sooMFXeZR4j1O7fZngAWgn_Bmbo\",
    \"kty\":\"OKP\",
    \"x\":\"tIUiRZkBczC152j1ItfvtITl222ZHLcz6wRqUDa0-Ls\"
}">>
                }
            }
        }}
    ]},

    {scoper, [
        {storage, scoper_storage_lager}
    ]},

    {lager, [
        {error_logger_redirect, true},
        {crash_log, false},
        {log_root, "/var/log/cds"},
        {handlers, [
            {lager_file_backend, [
                {file, "console.json"},
                {level, debug},
                {formatter, lager_logstash_formatter},
                {formatter_config, [
                    {message_redaction_regex_list, [
                        "[0-9]{12,19}", %% pan
                        "[0-9]{2}.[0-9]{2,4}", %% expiration date
                        "[0-9]{3,4}" %% cvv
                    ]}
                ]}
            ]}
        ]}
    ]}
].
